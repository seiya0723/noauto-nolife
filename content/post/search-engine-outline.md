---
title: "Djangoでさらに高度な検索エンジンを実装するには？【自然言語処理】"
date: 2021-07-30T09:38:12+09:00
draft: false
thumbnail: "images/django.jpg"
categories: [ "サーバーサイド" ]
tags: [ "Django","上級者向け","AI","自然言語処理","コラム" ]
---


言葉通りで検索しなければヒットしない検索機能ほど使いづらいものはない。

まずは、下記リンク(NHK、みんなのきょうの料理)の右上の検索欄から、『茄子』『ナス』『なす』とそれぞれ検索してもらいたい。

https://www.kyounoryouri.jp/

いずれも検索結果に表示される件数が同じであることがわかる。

これはサーバーサイド(もしくはJavaScript)で漢字、カタカナ、ひらがなをそれぞれ直して検索しているのだと推測できる。

カタカナとひらがなの変換は特別なライブラリなしでも簡単に実現できる。下記リンクに倣って、文字コードを書き換えてしまえば良いのだ。

http://orange-factory.com/sample/utf8/code3/e3.html#Hiragana

http://orange-factory.com/sample/utf8/code3/e3.html#Katakana

しかし、漢字は簡単にはいかない。2つの漢字が1つになることで別の意味になる。音読みと訓読みがある。そこで登場するのが、形態素解析である。



## 形態素解析

[形態素解析 - Wikipedia](https://ja.wikipedia.org/wiki/%E5%BD%A2%E6%85%8B%E7%B4%A0%E8%A7%A3%E6%9E%90)

一言で言ってしまうと、日本語の辞書である。品詞ごとに言語を辞書に登録しておくことで、文字列の品詞分解を行い、漢字の読み方がわかるだけでなく、活用までわかる。

Pythonには形態素解析ができるライブラリがいくらかある。

### Mecab

代表的な形態素解析器。


### Janome

MecabをPythonだけで作ったもの。Python上で動かすのは比較的容易ではあるが、全てPythonで書かれているため処理速度が極端に遅い。

とりあえず試してみたい人向け。


### Juman/Juman++

俗語や単語ごとにカテゴリやドメインが記録されている、高機能な形態素解析器




## Djangoの検索に形態素解析機能を実装するには？

ソースコードは[Djangoでスペース区切りでOR検索、AND検索をする方法【django.db.models.Q】](/post/django-or-and-search/)から流用。







### ユーザー投稿型のウェブアプリの問題

ここで、問題が発生する。

[みんなのきょうの料理](https://www.kyounoryouri.jp/)ではサイトを運営しているスタッフが投稿内容の管理を行っている。

『なす』であれば投稿する時に表記ゆれをチェックして、『茄子』と『ナス』を書き換えればいい。

しかし、クックパッドのように一般ユーザーが自由に投稿するスタイルであれば、投稿内容の表記ゆれが発生する。

形態素解析器で別表記を取得した後、DBに何度も検索をかけるのは負担になる。



## 結論

おそらく、3大サーバーサイドフレームワークの中でもとりわけAIの親和性が高いものはDjangoであると思う。



