---
title: "【Django】canvasで描画した画像をAjax(jQuery)を使ってサーバーへ送信する【お絵かきBBS、イラストチャット、ゲームのスクショ共有などに】"
date: 2021-09-29T07:25:39+09:00
draft: true
thumbnail: "images/js.jpg"
categories: [ "フロントサイド" ]
tags: [ "JavaScript","jQuery","canvas","Ajax","Django","上級者向け" ]
---

例えば、チャットサイト、掲示板サイトでユーザーが描画したイラストを投稿できる形式にしたい時。

ユーザーが手元の端末でペイントツールを起動して画像を保存して、サイトに添付して貼り付けるのはやや面倒。それだけでなく、サイト独自のレギュレーション(お題に沿ってイラストを付け加える形式、指定された色しか使ってはいけないなど)がある場合、ユーザーのペイントツールでそれを強いるのは不可能に近い。

そこで、サイト上でイラストが描画できるよう、canvas要素を使用して、Ajax(jQuery)でサーバーへ送信を行う。フロントからサーバーサイドまで一貫性がなければ実現できないので、私が得意のDjangoで実現させ、ここにその方法を記す。

コードは[40分の簡易掲示板のコード](/post/startup-django/)を流用して作っている。
 
## フロントサイドのコード

まずはHTML。




Ajaxで表示する領域を別テンプレート化。





続いてJavaScript。canvasの描画処理、Ajaxの送信処理の2つを記述している。





## サーバーサイドのコード

`models.py`にて、`ImageField`を追加する。`settings.py`と`urls.py`で画像送信可能なように仕立てる。







詳しくは『[Djangoで画像及びファイルをアップロードする方法](/post/django-fileupload/)』を参照。

`forms.py`にて、モデルを継承したフォームクラスを定義する。




`views.py`にて、Ajaxを受取り、バリデーションをした上で保存。`JsonResponse`を返却。








## 実際に動かすとこうなる。











## 結論

似たような内容を[動画のサムネイルを作る記事](/post/django-ajax-thumbnail-upload/)でも解説したが、今回は流用が効くようになるべくシンプルに仕立てた。

スマホでの利用も考慮すると、canvasの表示領域は最大で300pxが妥当かと思われる。

これはただcanvasの表示領域から画像を作って、Ajaxでサーバーへ送信しているだけだから、canvasゲームのスクリーンショット共有などにも応用できる。


## ソースコード
