---
title: "【Django】バッチ処理のOpenCVが撮影した画像をDBに保存する"
date: 2021-03-16T16:15:03+09:00
draft: true
thumbnail: "images/django.jpg"
categories: [ "サーバーサイド" ]
tags: [ "Django","システム管理","上級者向け","tips","AI","OpenCV" ]
---



Djangoのバッチ処理を実行し、DBにデータを格納させる。ただし、OpenCVで撮影した画像をDBに保存させる。本記事ではその手順を記す。



## 実行環境・やりたいこと

### 実行環境

- Django 2.2以上
- Ubuntu 18.04

### やりたいこと

流れはだいたいこんな感じ


1. OS起動時、バッチ処理がCrontabから実行される
1. バッチ処理はOpenCVを使用し、撮影した画像を保存
1. 保存した画像とコメントをDBに記録
1. 1秒経ったら、2に戻る

つまり、コマ撮りした画像をDBに次から次へと記録していく。これで監視カメラ風のウェブアプリを作ることができる。


## 問題点

バッチ処理からDBに文字列を突っ込むだけであれば簡単である。対象のモデルをインポートして、モデルオブジェクトから保存させれば良い。

しかし、画像を保存するとなるとワケが違う。普通、Linuxにデプロイした時、通常のリクエストで画像をアップロードすると画像は`/var/www/プロジェクト名/media/`に保存される。バッチ処理のOpenCVが`/var/www/プロジェクト名/media/`に保存すると、アクセス権の問題が出る可能性がある。(未検証につき要注意)つまり、OpenCVで撮影した画像を閲覧することができないのだ。

そこで、通常のリクエストからの送信と同様に、リクエストオブジェクトを生成した上で、画像データをサーバーに保存してもらう。


## バッチ処理のソースコード







## 結論









## ソースコード







