---
title: "【Stripe】Djangoにクレジットカード決済機能を実装させる"
date: 2022-01-28T08:08:33+09:00
draft: true
thumbnail: "images/django.jpg"
categories: [ "サーバーサイド" ]
tags: [ "django","Stripe","スタートアップシリーズ","上級者向け" ]
---



DjangoでECサイトや課金ゲームサイト等を展開しようと考えているのであれば、避けて通ることができないのがカード決済。

Stripeというカード決済代行会社を利用することで、決済処理を手軽に実装させることができる。

本記事ではその一例を紹介する。


## 決済処理の大まかな流れ

まず決済処理は以下の流れに沿って行われている。

1. 属性に公開鍵をセットしたStripeのJSが発動(ここでstripe側が公開鍵の有効性を確認している)
1. カード番号を入力してカードの有効確認。stripeTokenにセットされDjangoにPOST文が送られる
1. 下記のCheckoutViewのPOSTメソッドの処理が実行される。
1. 公開鍵に対応した秘密鍵とトークンをセット。(自サイトの公開鍵を使用して決済を試みている事をチェックする)
1. stripe.Charge.createが実行。決済処理が実行される。

※最新版はやや異なる。

まずDjangoがセッションを発行し、その上でトークンをセットしてクライアントが決済処理を実行する。Stripeに送信され、決済完了となる。


つまり、ビューでやることはStripeのセッションの作成とクライアントから送られてくるトークンの検証。

セッションを作り、そのセッションでクライアントが決済を行い、その上で生成されるトークンをDjangoがStripeにアクセスして検証をする。


