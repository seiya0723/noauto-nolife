---
title: "シェルの標準入出力と標準エラー出力の取り扱いについて"
date: 2018-12-11T15:15:02+09:00
draft: false
thumbnail: "images/command.jpg"
categories: [ "command" ]
tags: [ "bash" ]
---

<p>シェルには標準ストリームである標準入出力と標準エラー出力を取り扱うためのファイル識別子が用意されています。ファイル識別子を活用することによって、エラー出力の収集など様々なものに応用可能です。</p>

<ul>
<li><a href="#chapter1">標準入出力と標準エラー出力の違いとは</a></li>
<li><a href="#chapter2">標準入出力と標準エラー出力の取り扱い方法</a></li>
<li><a href="#chapter3">活用例</a></li>
<li><a href="#chapter4">結論</a></li>
</ul>

<h2 id="chapter1">標準入出力と標準エラー出力の違いとは</h2>

<h3>標準入力について</h3>

<p>標準入力とはユーザーがシェルに入力する文字列のことを言います。</p>

<p>例えばC言語であれば<code>scanf</code>や<code>fgets</code>関数を使用したときに標準入力が使用されています。ユーザーから値を受け取って、その値をもとにプログラムが動く仕組みです。</p>

<p>ユーザーから標準入力を要求せず、処理結果だけを出力するコマンドやプログラムも存在します。UNIXコマンドであれば<code>ls</code>や<code>df</code>コマンドなどがあります。</p>

<h3>標準出力について</h3>

<p>標準出力はシェルに何らかの文字列や処理結果を表示するためにあります。C言語であれば<code>printf</code>関数などを利用します。</p>

<p>しかし全てのプログラムが標準出力をするとは限りません。システムのバックグラウンドで稼働するデーモンプロセスを始め、<code>mkdir</code>や<code>cp</code>などと行ったファイル操作関係のコマンドではシェルに処理結果が出力されないこともあります。</p>

<h3>標準エラー出力について</h3>

<p>標準エラー出力はプログラムのエラーメッセージをシェルに出力するためのものです。</p>

<p>標準出力と標準エラー出力は同じようにシェル上に出力されるものですが、後述のファイル識別子が異なっています。そのためエラーメッセージだけを任意のファイルにリダイレクトすることが可能です。</p>

<h2 id="chapter2">標準入出力と標準エラー出力の取り扱い方法</h2>

<p>標準入出力と標準エラー出力にはそれぞれファイル記述子が割り当てられています。このファイル記述子をもとに取り扱う必要があるのです。</p>

<table>
<thead>
<tr>
<th>ファイル記述子</th><th>内容</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th><th>標準入力</th>
</tr>
<tr>
<th>1</th><th>標準出力</th>
</tr>
<tr>
<th>2</th><th>標準エラー出力</th>
</tr>
</tbody>
</table>

<p>ご覧の通りファイル記述子は整数なので、整数型（int型）として取り扱うことが可能です。</p>

<p>C言語で標準入出力と標準エラー出力を行うためには、ライブラリである<code>stdio.h</code>をインクルードしておく必要があります。<code>stdio.h</code>をインクルードさせることによって標準入出力や標準エラー出力関係の関数を使用することができるのです。</p>

<p>ただしPythonでは、あえて標準入出力関係のライブラリ（モジュール）をインクルードする必要はありません。</p>


<h2 id="chapter3">活用例</h2>

<p>標準入出力と標準エラー出力を取り扱うことができるようになれば、保守作業やリダイレクトする内容を自由に変更可能になります。</p>

<h3>標準エラー出力のリダイレクト</h3>

<p>標準エラー出力は標準出力とは別のファイル識別子になっているので、普通にリダイレクトを行ったとしても反映されません。</p>

<p>エラーのあるプログラムを実行して結果をリダイレクトしてみましょう。</p>

<div class="img-center"><img src="/images/20181211001.jpg" alt="標準エラー出力は通常の方法ではリダイレクトされない" /></div>

<p>リダイレクトされたテキストファイルには標準出力だけが記録されています。</p>

<p>しかし、標準エラー出力を標準出力として取り扱うことによってリダイレクト先のファイルに書き込むことが可能です。コマンドは簡単で下記の文字列を末尾に追加します。</p>

<pre><code>2>&1</code></pre>

<div class="img-center"><img src="/images/20181211002.jpg" alt="標準出力と標準エラー出力を同時にリダイレクトする" /></div>

<p>もちろん標準エラー出力だけをリダイレクトして、シェルには標準出力を行うことができます。リダイレクトする対象のファイル識別子を指定すれば良いのです。</p>

<pre><code>2>>[任意のテキストファイル]</code></pre>

<div class="img-center"><img src="/images/20181211003.jpg" alt="標準出力と標準エラー出力を同時にリダイレクトする" /></div>

<p><code>>></code>の後の空欄はどちらでも構いませんが、ファイル識別子である2と<code>>></code>の間の空欄は記述せずに、連続して記述しましょう。</p>

<h3>処理結果をシェルへ何も出力させない</h3>

<p>コマンドによっては、処理の結果をシェルに出力しないオプションもありますが、用意されていないこともあります。適当なファイルに出力をリダイレクトしてあとで削除する方法もありますが、あまりスマートではありません。</p>

<p>そこで、標準出力と標準エラー出力を<code>/dev/null</code>にリダイレクトすることで、シェルの汚染を防ぎましょう。</p>

<p><code>/dev/null</code>にリダイレクトされた情報は全て破棄されます。つまり、適当なファイルにリダイレクトしてあとで削除するよりも、最初から<code>/dev/null</code>にリダイレクトするほうが安全ですし早いです。</p>

<p><code>/dev/null</code>に標準出力と標準エラー出力をリダイレクトするには下記の文字列をコマンドの末尾に入力します。</p>

<pre><code>> /dev/null 2>&1</code></pre>

<div class="img-center"><img src="/images/20181211004.jpg" alt="標準出力がされていない" /></div>

<p>標準出力だけを<code>/dev/null</code>に送り込み、標準エラー出力だけをシェルに表示したい場合はこうします。</p>

<pre><code>> /dev/null</code></pre>

<div class="img-center"><img src="/images/20181211006.jpg" alt="標準出力だけを非表示にさせる" /></div>

<p>標準エラー出力だけがシェルに表示されました。</p>

<p>ファイルの書き込みや編集などが反映されないかと思われますが、問題なく実行されます。試しに上記の文字列を追加して、wgetコマンドを実行してみましょう</p>

<pre><code>wget example.com > /dev/null 2>&1</code></pre>

<div class="img-center"><img src="/images/20181211005.jpg" alt="標準出力がされないが処理は行われている" /></div>

<p>問題なくexample.comのHTMLデータである<code>index.html</code>がダウンロードされていることがわかります。</p>

<p>ただし、これらはバックグラウンドで実行するわけではないので、全ての処理が終わるまでシェルに何かを入力することはできない点に注意しましょう。</p>


<h2 id="chapter4">結論</h2>

<p>標準入出力と標準エラー出力の取り扱いができるようになれば、自作のプログラムの保守作業の効率化だけでなく、処理結果を表示させずに実行させることも可能です。</p>

<p>エラーの再現が難しかったり、エラーが出力されたりされなかったりする場合でも、予め標準エラー出力をリダイレクトして処理を繰り返すことで保守も捗るでしょう。</p>


